language: python
dist: xenial
python:
- 2.7
- 3.6
matrix:
  allow_failures:
  - python: 2.7
install:
- pip install pipenv
- pipenv install --dev --deploy --python `which python`
- pipenv graph
- if [[ $TRAVIS_PYTHON_VERSION == 3.6 ]]; then pip install -e git+https://git@github.com/uc-cdis/wool.git#egg=wool;
  fi
script: pipenv run py.test -v
after_script:
- if [[ $TRAVIS_PYTHON_VERSION == 3.6 && $PR_NUMBER != false ]]; then wool; fi
before_deploy:
- sed -i.bak "s/=get_version()/='$TRAVIS_TAG'/g" setup.py
- cat setup.py
- if [ $(python setup.py --version) == '0.0.0' ]; then travis_terminate 1; fi
deploy:
  provider: pypi
  user: uc-ctds
  password:
    secure: SgpCLTs5m220L/vzbntmPkm9DinEHV/hFG+fdXAobxwX237PnXIqeOBnAZClEOG8+yZRMa7NWyD1jGmuWPEQV4ptCYTIu8TRySUhSLvBe1hoghmJaUFrHng/HwdTItXFV5sSVvuIaQjg3Jq0QcjNjmo+T8sI1CD5w+83KiU16GDvyue9Lg1pbBV83YwDP2QqBhMlh6iVEKeVN9HFgu78r0BXloiQYKjVu66O6/X/JPXxQqyKsSencZPl7xzNBxKZC94QEGckK1l8V3RdGyu/CPeC6ubcew07A7ZgQZQy62zybvs/RW5YnyH4S9UYlVuSSzNmQtbWy+IIRYpujtxxsQ9c99dqVfRGf5szdXs31r9K5wHDbGqto1NSXKz1yjOVPVGgVGT/ZVNAUjAonH6KlUarc8URHVpvUoEzGEaf5e3I7Kp8tQWfM2fvabfG2tSonscaDpj2oybCBiJ5ds9FMLy74DJwy8YfIGvO8i0jXoWMVVbJUPzWGwgwdXN75LMUVF2peFsQXzJYDacSLLp+zwACjA7WuUNLH75SKLmXWtu1Bnc/ULHnMH/UxwKEXgPVrDaOZVvUNqrk1j8BlxaN6f17WGMvZW5YmRM/7TLcqRCweWsekt8vL8zp2Nx+Q2Wwadyssjardap03U+o8Tew4zDtgv4+tHeMpOfhs/99fpI=
  skip_existing: true
  skip_cleanup: true
  on:
    python: 2.7
    repo: uc-cdis/cdis-python-utils
    tags: true
env:
  matrix:
  - REPOSITORY="uc-cdis/cdis-python-utils" PR_NUMBER="$TRAVIS_PULL_REQUEST"
  global:
  - PIPENV_IGNORE_VIRTUALENVS=1
  - secure: qoMlJG2/e/ExVimSYtWbFxaePA7wSUgjsENaJPmAZKvisaSmbh3+BjlGc0128NViYGXMg2ljk2ofzST7/ktlJhnfewFrVHMctJsDppC0cmYXYQsXdGlFC59UDZXzp+jj4dRVSBiFUbIcznQDuGQ9z9rZs/dAHxPyVfgZoKbvuAiW+vNh+9veVvMfTFdSl6xNC4VBAk1BSWwRgYzYRyUFCXTmX+LbKN6SbyXpZXEwHoLCzKGePDK4SOHeFMSVhPryWtID1aCZYHHRm1ctFTjgvuAJ6s58Tlui5K9w4LFzlyhbWPE/T42cO1Azuqm+T/UZkD9k//rIj6yZb+JuxTNaIhosmB83MYzD/XhOEqCKoUjvYAHT1FwVpuml8/lm16EEloerag6yudAuVwerOQtPp3bcYANtKy78dLtVbu6AUDlpgjy3TELR60n02JDP2C5eu/3Bf2yLY3zOgshWluq6pTgX1PDaBgVL6PwDjnGtWI4Xpblt56rCYKvqHVqkQJzmTGP6epooiNEKaWy9tSo4aHRw82uzqOJY7Y3vr2eJ1vUtV5MBTSDnZyclRvEJA+qB6vHHSO7FRzTnzdvRmCO2VFOF+VfRGk8p331bBhotHIKxu5SwYxG97L8QuS4H9yni9zw039tCqluj2sEZ2xER/2AWCFtayty5ldz1SXIyY6U=
after_deploy:
- pipenv run pip install gen3git
- pipenv run gen3git release
